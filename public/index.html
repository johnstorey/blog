
<!DOCTYPE HTML>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<title>A blog about faith, tech and management.  | John Dreams</title>

	<meta name="author" content="John Storey">

<meta name="description" content="It&rsquo;s been quite a while since this blog has been posted too &mdash; or existed! Apparently the VPS hosting it was killed in a cleanup at some &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="John Dreams" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">John Dreams</a></h1>
<span class="tagline">A blog about faith, tech and management.</span>
<nav id="main-nav"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</div>
	</div>
</nav>


</header>

	<div id="content" class="inner">


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2014/07/09/drupal-access-grants/">
			
				Drupal Access Grants</a>
		</h2>
		<div class="meta date">








  


<time datetime="2014-07-09T15:25:19-07:00" pubdate data-updated="true">Jul 9<sup>th</sup>, 2014</time></div>
	</header>
	<div class="entry-content">
		<p>It&rsquo;s been quite a while since this blog has been posted too &mdash; or existed! Apparently the VPS hosting it was killed in a cleanup at some point in the past. I&rsquo;ve lost some posts. Oops!</p>

<p>But we are back, and today is a topic on one of my favorite topics &mdash; coding Drupal. In this case, Drupal 7.</p>

<h1>Access and Access Grants</h1>

<p>The last time I tried to customize the permission rules in Drupal was in Drupal 6, and grants were not an option. Instead there was the node access system, and various modules you could use to customize them. IIRC, I ended up using taxonomy access lite, which allowed me to customize access based on the tag on the content type. If any code denied access to a piece of content, even if 10 other modules said &lsquo;allow&rsquo;, the access was not granted. On top of that, the node access system seemed fairly fragile.</p>

<p>The experience sucked.</p>

<p>As part of a Drupal application in the health care industry I had to put some interesting rules around CRUD access to a content type, Prescription. Specifically the interesting requirements were</p>

<blockquote><p>Create a content type &lsquo;Prescription&rsquo;.
Give it a reference to an associated Nurse writing the Prescription.
Give it a reference to an associated Doctor, who can alter and approve the prescription.
Make the Prescription private to the client organization on the web application.
Within that organization, only let the Doctor and Nurse referenced by a Prescription view it.</p></blockquote>

<p>It was the last one that got me thinking. I started research, and found that Drupal 7 has hook_node_access_records() and hook_node_grants(). A little time with a debugger and watching changes to the node_access table opened up a clean, simple implementation of the requirements.</p>

<h1>How Access Grants Work</h1>

<p>Here is how things work. All access to a node in Drupal must pass permission checks according to the settings in the node_access table. So while you are developing, keeping an eye on this table is a wise idea.</p>

<p>When you do nothing, a row is created in that table that allows anyone to view that content type. But we aren&rsquo;t going to &ldquo;do nothing&rdquo; &mdash; we are going to make our own rules.</p>

<p>When you implement hook_node_access_records(), it will be called every time a node is saved. You have the opportunity to change what is going into the node_access table at this point. While you can read the details at <a href="https://api.drupal.org/api/drupal/modules%21node%21node.api.php/function/hook_node_access_records/7">hook_node_access_records</a>, here is a simple one that modifies the access grant for a Prescription content type.</p>

<pre><code>function mymodule_node_access_records($node) {
  $grants = array() ;

  if ($node-&gt;type == 'prescription') {
    $grants[] = array(
      'realm' = 'all',
      'gid' =&gt; 0,
      'grant_view' =&gt; 0,
      'grant_update' =&gt; 1,
      'grant_delete' =&gt; 0,
      'priority' =&gt; 1,
    );
   }
 return $grants;
}
</code></pre>

<p>The interesting points here are the &lsquo;realm&rsquo; and &lsquo;gid&rsquo; parameters. Together, with the $node->id field, comprise the key of the node access table. Combined, the realm and gid are a unique grant for the node. There values are abritrary, but the gid must be an integer.</p>

<p>So the above says if someone has the realm &lsquo;all&rsquo; and gid &lsquo;0&rsquo;, don&rsquo;t let them see the node in question, let them update it, and don&rsquo;t let them delete it.</p>

<p>Once grants are checked, if they pass, then the base node access system &mdash; the one you usually modify on the permissions tab &mdash; are checked. If <em>both</em> pass then the node is presented to the user.</p>

<p>Now you get pretty flexible here. In my situation I made some custom permissions, named the realms after them, and made two entries in the $grants array. In them I used, in turn, the user id of the Doctor and Nurse referenced by the Prescription. Now I had two rows in the node access table for the Prescription. One for the Doctor and one for the Nurse.</p>

<p>But how about the check when viewing the node?</p>

<h2>hook_node_grants</h2>

<p>This is the other side of the equation. When the user attempts to access the node for any CRUD operation, hook_node_grants is called in your module. Read the documentation here: <a href="://api.drupal.org/api/drupal/modules%21node%21node.api.php/function/hook_node_grants/7">hook_node_grants</a>.</p>

<p>Basically you are returning an array whose key is the realm from hook_node_access_records, and whose value is the gid. If a record in the node_access table matches the node id, the realm, and the gid, the access permissions for the operation in that row are used.</p>

<p>Let&rsquo;s say a user has the &lsquo;custom view prescription&rsquo; permission. You might write the hook like this</p>

<pre><code>function mymodule_node_grants($account, $op) {
  $grants = array();

  if (user_acces('custom view prescription', $account)) {
    $grants['custom view prescription'] = array($account-&gt;uid);
  }

  return $grants;
}
</code></pre>

<p>This code specifies to Drupal that, subject to the current permissions settings, the current user has the grant &lsquo;custom view prescription&rsquo;-uid. What that means was defined by a call to hook_node_access_records when the node was created.</p>

<h1>So What?</h1>

<p>When you take the time to think about it, I just very simply outlined a very small amount of code that implements a highly customized permissions system that, out of the box, Drupal does not support. Once I understood the interplay of the systems, this took about 2 hours to write and to write tests.</p>

<p>Grants, unlike custom access modules, even works with Views. This is a very flexible system that puts the ability to create all sorts of custom access patterns for your Drupal applications, meaning the complexity of the solutions you are able to provide just greatly increased.</p>

<p>Oh, and what about the standard access patterns? Well, after checking grants, Drupal still checks the regular access patterns. So if by some horrible mistake a doctor in one hospital is somehow associated with the prescription of another hospital, a smple separation of content into private organic groups denies the inappropriate access.</p>

<p>This was the result of a delightful Saturday afternoon with the Drupal documentation, a book on Safari Books Online, and a debugger. Some days just go nice.</p>

<p>Now back to running the engineering department. Annual reviews are due in a week &hellip;</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2012/12/06/emacs-dired-nodes/">
			
				Emacs Dired Nodes</a>
		</h2>
		<div class="meta date">








  


<time datetime="2012-12-06T07:09:00-08:00" pubdate data-updated="true">Dec 6<sup>th</sup>, 2012</time></div>
	</header>
	<div class="entry-content">
		<h1>Dired mode in Emacs.</h1>

<p>As part of my current attempt to revive old / acquire new Emacs skills, these are notes to myself on some of the neat things you can do with dired mode. This effort is motivated by the fact I now develop locally on OS-X, remotely on an Ubuntu VM, and plan to dual-boot the new Macbook Pro. Also, occasionally, I pair program with one of my guys on their VM or machine.</p>

<p>So I&rsquo;ve cleaning up my github account with my dotfiles so that I can more easily move my environment between machines and use the same tools, such as Emacs.</p>

<p>Emacs has too much beauty to grok fully while remembering to find time to breathe, so this is a subset of notes gathered from several sources.</p>

<table border="1" class="nrm" style="border:solid 1px #000000;border-collapse:collapse;margin:.5ex; width: 100%">
  <caption>Dired Commands</caption>
  <tr>
    <td align="center" valign="top" style="border:solid thin #808080; padding: .5ex; width: 20%;">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M-x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;find-dired-mode&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;M-x&nbsp;hl-line-mode&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;highlights&nbsp;current&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<enter>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      go&nbsp;into&nbsp;a&nbsp;directory&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;leave&nbsp;a&nbsp;directory&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C-s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      change&nbsp;arguments&nbsp;to&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;inserts&nbsp;directory&nbsp;
      &nbsp;under&nbsp;cursor&nbsp;into&nbsp;&nbsp;current&nbsp;buffer.
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;deletes&nbsp;directory&nbsp;&nbsp;<br />
      from&nbsp;current&nbsp;buffer&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;touch&nbsp;current&nbsp;file&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;rename&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;symlink&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;compress&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;uncompress&nbsp;file&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;mark&nbsp;for&nbsp;deletion&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;expunge&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;unmark&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;unmark&nbsp;all&nbsp;files&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C-t&nbsp;C-t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      Incrementally&nbsp;search<br />
      &nbsp;through&nbsp;all&nbsp;files&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      mark&nbsp;files&nbsp;based&nbsp;on&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;regexp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      mark&nbsp;all&nbsp;directories
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;copy&nbsp;marked&nbsp;(or&nbsp;&nbsp;&nbsp;<br />
      &nbsp;current)&nbsp;items&nbsp;to&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kill&nbsp;ring&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="center" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C-x&nbsp;C-q&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top"  style="border:solid thin #808080; padding: .5ex" >
      &nbsp;&nbsp;wdired.&nbsp;All&nbsp;file&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;names&nbsp;are&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;editable.&nbsp;Commit&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;with&nbsp;&#8216;C-c&nbsp;C-c&#8217;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
</table>


<h2>Primary sources:</h2>

<ul>
<li><a href="http://emacsmovies.org/blog/2012/12/04/dired/">http://emacsmovies.org/blog/2012/12/04/dired/</a></li>
<li><a href="http://ergoemacs.org/emacs/file_management.html">http://ergoemacs.org/emacs/file_management.html</a></li>
</ul>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2012/11/14/emacsclient-ignores-init-file/">
			
				Emacsclient Ignores Init File</a>
		</h2>
		<div class="meta date">








  


<time datetime="2012-11-14T21:47:00-08:00" pubdate data-updated="true">Nov 14<sup>th</sup>, 2012</time></div>
	</header>
	<div class="entry-content">
		<p>Strangely</p>

<p><code></p>

<pre><code>emacsclient -t
</code></pre>

<p></code></p>

<p>does not seem to use my ~/.emacs.d/init.el file in the latest Emacs 24 when I start it as a daemon and open a frame. This is true on Ubuntu 12.?? and OSX.</p>

<p>This is really irritating, but since I really only need one frame 99% of the time I guess I&rsquo;ll ignore it. I did put an hour into playing with it and following Google Searches, but if anyone can tell me why this is so, I&rsquo;d love to know. I&rsquo;d like to have the daemon started when I boot my Macbook and my development VM, then have the client come up fast.</p>

<p>Interestingly if I load the init file in a buffer and evaluate the buffer, it all works fine.</p>

<p>Humpf.</p>

<p><strong>UPDATE:</strong> Of course this was simple late night, unclear thinking. All that was not working was keyboard-translate, which makes sense. Adding an alias to my environment worked around the issue and now all is well.</p>

<p><code></p>

<pre><code>alias emacs=emacsclient -t --eval '(keyboard-translate ?\C-t ?\C-x)'
</code></pre>

<p></code></p>

<p>Now my emacs setup runs in all my environments properly. Next: move the various dotfilies into a <em>dotfiles/</em> directory, toss it on github, and replicate that across environments. This will also neccessitate some thought as I commonly run tmux on my Macbook, ssh to my development server, then run tmux there. So the same .tmux-conf file with the same control key clearly won&rsquo;t work.</p>

<p>Maybe it&rsquo;s time to simply stop doing that and change my workflow. A problem to think about after a good nights sleep &hellip;</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2012/11/07/emacs-optimizations-to-make/">
			
				Emacs Optimizations to Make</a>
		</h2>
		<div class="meta date">








  


<time datetime="2012-11-07T07:44:00-08:00" pubdate data-updated="true">Nov 7<sup>th</sup>, 2012</time></div>
	</header>
	<div class="entry-content">
		<p>Notes to myself:</p>

<p>Optimize Emacs for ctags with current usage (PHP and JS mostly):</p>

<p><a href="http://www.koumbit.org/en/articles/using-exuberant-ctags-drupal">http://www.koumbit.org/en/articles/using-exuberant-ctags-drupal</a></p>

<p><a href="http://mwop.net/blog/134-exuberant-ctags-with-PHP-in-Vim.html">http://mwop.net/blog/134-exuberant-ctags-with-PHP-in-Vim.html</a></p>

<p><a href="http://weblogs.asp.net/george_v_reilly/archive/2009/03/24/exuberant-ctags-and-javascript.aspx">http://weblogs.asp.net/george_v_reilly/archive/2009/03/24/exuberant-ctags-and-javascript.aspx</a></p>

<p>Make Emacs work with terminal that works with Zsh and Tmux embedded (yes, that&rsquo;s right! Tmux in Emacs, not the other way around! It works for my workflow.):</p>

<p><a href="http://stackoverflow.com/questions/367442/getting-emacs-ansi-term-and-zsh-to-play-nicely">http://stackoverflow.com/questions/367442/getting-emacs-ansi-term-and-zsh-to-play-nicely</a></p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2012/11/02/traveling-november-2012/">
			
				&#8216;Traveling November 2012&#8217;</a>
		</h2>
		<div class="meta date">








  


<time datetime="2012-11-02T06:57:00-07:00" pubdate data-updated="true">Nov 2<sup>nd</sup>, 2012</time></div>
	</header>
	<div class="entry-content">
		<p>For November I am telecommuting from Paris (though back in the U.S. a short time the first week of November.)</p>

<p>For updates, check out the online travel blog at</p>

<p><a href="http://www.offexploring.com/john-and-wini-paris-2012">http://www.offexploring.com/john-and-wini-paris-2012</a>.</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2012/10/18/tradeoffs-pre-paying-a-mortgage/">
			
				&#8216;Tradeoffs Pre-paying a Mortgage&#8217;</a>
		</h2>
		<div class="meta date">








  


<time datetime="2012-10-18T13:49:00-07:00" pubdate data-updated="true">Oct 18<sup>th</sup>, 2012</time></div>
	</header>
	<div class="entry-content">
		<p>These are some musings I have been having on the relative benefits of pre-paying your mortgage.</p>

<p>You see, I am in the process of buying a nice little loft conversion. Naturally the girlfriend is &mdash; before we are even funded &mdash; trying to figure out how quickly we can pre-pay the mortgage. Bless her financially conservative heart.</p>

<p>My first, unthinking reaction was to recoil in horror at the idea. &ldquo;We are getting under a 4% rate on this! Do you really think the Fed will keep inflation under 4% for the whole time we live here? Once they slip and it rises a little, we&rsquo;ll be effectively paying 0% on the loan. I NEVER want to pay an extra penny here!&rdquo;</p>

<p>Silly me. I actually do know better.</p>

<p>For those who are unaware, mortgages are not like an IOU with an interest rate. They are <em>amortized</em>. You can look up the details on Wikipedia, but for our purposes realize that 90%+ of your payments in the early years are the interest for the entire 30 years. Almost none of those payments reduce the principle of the loan.</p>

<p>Also realize I live in California, a no pre-payment penalty state. Lastly realize that if you pay more than your monthly payment and mark it as &ldquo;pay to principal&rdquo; you not only pay your principle down, but you cause them to re-amortize the loan. In essence, you drastically reduce the total amount of interest your are paying. Playing around with the calculator at <a href="http://www.bankrate.com/calculators/mortgages/mortgage-loan-payoff-calculator.aspx">pre-payment calculator</a> I see the following at an extra $3,000 a month to principal:</p>

<ul>
<li>$3,000 extra a month seems to be the point of diminishing returns.</li>
<li>My interest drops from about $150K to $50K over the life of the loan.</li>
<li>The loan is paid off in about 7 years rather than 30.</li>
</ul>


<p>Assuming it is possible to consistently pay an extra $3,000 a month I should do it right? I mean, I am avoiding $100K of $150K interest that way, which is a great return.</p>

<p>Well &hellip; there is this thing called the mortgage interest tax deduction. Both Obama and Romney are talking about getting rid of it despite who is elected next year, but I have my doubts. So now you have to add that in as well.</p>

<p>That&rsquo;s before considering things like the size of the emergency fund, expected household budget adjustments associated with owning a home, and so on. The point is that it is very hard to determine how much principal to pre-pay on a mortgage, and if it makes sense to do so. So don&rsquo;t blindly choose a &lsquo;yes&rsquo; or &lsquo;no&rsquo;. Instead sit down and do some real analysis of your situation.</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2012/10/08/polyslipups-and-house-hunting/">
			
				Polyslipups and House Hunting</a>
		</h2>
		<div class="meta date">








  


<time datetime="2012-10-08T09:48:00-07:00" pubdate data-updated="true">Oct 8<sup>th</sup>, 2012</time></div>
	</header>
	<div class="entry-content">
		<p>Just a quick update in my journal here.</p>

<p>Friday night I decided to sleep through the night. This turned out to be a suprisingly bad idea. Rather than giving me an exceptionally good nights sleep I work irritable, and stayed that way through the day. Also, I did not stay awake on Saturday from an unusual amount of exhaustion. Luckily I seem to have gotten back on Everyman 3 Sunday and feel like I am on track again.</p>

<p>On top of that I did not realize how used I had already become to having the additional time. Much was not done and frustration ensued. The upshot: monophasic is not a sleeping pattern that maximizes my happiness.</p>

<p>Also on Friday, even though we weren&rsquo;t planning to be ready to buy a house until December, but an incredible loft conversion in the right place with all the right things came on the market. We made an offer, and I spent Saturady putting together the financial paperwork for the loan application. It is very unlikely that it will all work out and we are likely to proceed with the original plan to look in December / January, but it would be very nice to get this one.</p>

<p>Don&rsquo;t ask me if it will work out &mdash; I think our lack of preparation led to a weak offer. But maybe God thinks differently. I&rsquo;ve seen much stranger things happen.</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2012/09/29/sleep-still-rules-me/">
			
				&#8216;Sleep Still Rules Me&#8217;</a>
		</h2>
		<div class="meta date">








  


<time datetime="2012-09-29T16:55:00-07:00" pubdate data-updated="true">Sep 29<sup>th</sup>, 2012</time></div>
	</header>
	<div class="entry-content">
		<p>This is more a note to myself so I can reflect on it in the future.</p>

<p>I am now on day 6 of Everyman 3. I misset the alarm for my 11 AM nap and overslept by about an hour. So I figured &ldquo;hey, no worries, at least I can skip my 4 PM nap.&rdquo; At 4 I was in a local coffee shop watching an MIT Open CourseWare class. Suddenly a wave of weariness washed over me.</p>

<p>Apparently my body is getting used to sleeping at 4 PM for 20 minutes. This is great! So I went home and lay down. Without even realizing that I had fallen asleep I awoke 13 minutes later. I felt relaxed and very awake.</p>

<p>So what am I deducing? My body is adjusting to the Everyman 3 sleep schedule well. While I could have stayed awake it would have been very sub-optimal.</p>

<p>Things I did in the last 24 hours I would not have done on a regular sleep schedule:</p>

<ul>
<li>Evaluate ZSH and installed it on my Macbook Air.</li>
<li>Found an open source tiling window manager, Spectacle, and installed it on the Macbook Air as well.</li>
<li>Went through a calculus class with <a href="http://thegreatcourses.com">The Great Courses</a>.</li>
<li>Got about half way through the first MIT lecture I am taking.</li>
</ul>


<p>That&rsquo;s on top of my early Saturday morning bike ride, reading of Barron&rsquo;s, and catching up on the companies in my portfolio.</p>

<p>It&rsquo;s 5 PM now, and I plan to sleep only another 20 minutes in the next 10. What will I finish during that time?</p>

<p>I&rsquo;m loving this. Now to make some dinner, then get back to the MIT course. Eventually the my cute half(I refuse to say &lsquo;better half&rsquo; preferring equality) will wake up and we&rsquo;ll go to the movies to see Dredd. Yes, on top of everything else, I now have time to tend to the relationship again, and that&rsquo;s paying nice dividends as well.</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2012/09/29/first-polyphasic-friday/">
			
				First Polyphasic Friday</a>
		</h2>
		<div class="meta date">








  


<time datetime="2012-09-29T00:04:00-07:00" pubdate data-updated="true">Sep 29<sup>th</sup>, 2012</time></div>
	</header>
	<div class="entry-content">
		<p>Here it is midnight on my first weekend on Everyman 3. I lay down for 20 minutes at 10:30 PM, and now I&rsquo;m awake until 3 AM when I take a 3 hour sleep. That&rsquo;s the big sleep for the day, and the majority of the 4 hours a day rest.</p>

<p>So far it&rsquo;s good. I&rsquo;ve been allowing myself a cup of coffee when I first wake from a nap, but now I am wondering if it is interfering with my ability to take my naps. True, I am on day 4 and it is supposed to take a month to fully adapt, but I still feel I don&rsquo;t get to sleep fast enough on the 20 minute nap. In another week I&rsquo;ll have to see where I am &hellip;</p>

<p>My mental faculties are ok, but not the top of where they can be. I am not fully rested &mdash; but I am as rested as I was on a normal weeknights sleep. This is the first night to myself where I don&rsquo;t need to work with the offshore teams. I&rsquo;ve continued working on my long, backlogged TODO list. Today I fixed this blog and put it on GitHub. After 4 months I finally got the email at johnstorey.org working again. After I complete this post my plan is to evaluate ZSH as a Bash replacement. If I have time and motivation after that I will start going through the MIT Open Courseware classes for Scheme. I last programmed a Lisp language about 24 years ago (ouch! getting old, aren&rsquo;t I!). Scheme did not exist back then boys and girls. But these days I keep bumping into Clojure, which is Lisp based. My thought is to</p>

<ul>
<li>Learn Scheme.</li>
<li>Review the MIT Open Courseware algorithm classes that are in Scheme.</li>
<li>Work through a paper I found to write a Scheme compiler in Scheme.</li>
</ul>


<p>This will meet the goals I have of</p>

<ul>
<li>Getting back into a functional language.</li>
<li>Lay a foundation for Emacs scripting.</li>
<li>Refresh my algorithms knowledge &mdash; every developer needs to do this every few years.</li>
<li>Write a compiler, which strangely, I&rsquo;ve never done. In concept it seems simple. Read some text, follow rules to transform it, and end up with the final transform creating assembly or object code.</li>
</ul>


<p>Not sure how far I will get on the Scheme front tonight as I am feeling an urge to space out and watch Season 3 of Fringe on Amazon. But it would be good to start.</p>

<p>I am enjoying the extra free time. I event started a light exercise routine again. At 11 PM I was the only one in the fitness center on a Friday night. The security guard gave me strange looks as she walked by, but hey, I <em>am</em> living unusual hours right now. I&rsquo;ll monitor how the exercise interacts with my sleep schedule and overall rest.</p>

<p>Now, on to that ZSH evaluation &hellip;</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2012/09/28/blog-reboot/">
			
				Blog Reboot</a>
		</h2>
		<div class="meta date">








  


<time datetime="2012-09-28T10:30:00-07:00" pubdate data-updated="true">Sep 28<sup>th</sup>, 2012</time></div>
	</header>
	<div class="entry-content">
		<p>As you can see, after much time, my blog has been restarted and moved to GitHub. Of course it&rsquo;s probably the 3rd or 4th blog start in my life, and I have lost more information than I&rsquo;ve kept. But trying again. Here are the highlights.</p>

<h1>Still on Octopress</h1>

<p>I don&rsquo;t see myself leaving <a href="http://octopress.org">Octopress</a> as a solution any time soon. It&rsquo;s very OS agnostic and fits nicely into my workflow. I&rsquo;ve even installed a custom theme (that took about 2 minutes &mdash; I love todays world.)</p>

<h1>Moved to GitHub Pages</h1>

<p>Secondly, johnstorey.org continues to have issues. I believe I&rsquo;ll get the email working again but won&rsquo;t bother hosting the blog on S3 again. Since I was hosted there GitHub has apparently started a service where you can have one repository served up as webpages called GitHub Pages. You can use the built in support for them in Octopress by following the directions <a href="http://http://robdodson.me/blog/2012/04/30/custom-domain-with-octopress-and-github-pages/">here</a>.</p>

<p>Score!</p>

<p>There were some minor issues, such as my existing RVM / Ruby installation with Octopress did not work. But I installed Ruby 1.9.3 support under RVM, downlodade a clean Octopress repository, and was soon up and running. The main problem was that Xcode made me click &lsquo;Install Command line tools&rsquo; explicitly. Silly Apple &mdash; that should be the default!</p>

<p>So between polyphasic sleeping and the ease of use of GitHub Pages maybe you&rsquo;ll see more frequent posts here!</p>

		
		
	</div>

</article>


    <nav id="pagenavi">
        
        
            <a href="2" class="next">Next</a>
        
    </nav>

</div>
	<footer id="footer" class="inner">&copy; 2014

    John Storey

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/hyphenator.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'blogjohnstoreyorg';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






</body>
</html>
